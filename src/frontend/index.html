<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CineSearch - Movie Discovery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'slide-up': 'slideUp 0.4s ease-out',
              'pulse-glow': 'pulseGlow 2s ease-in-out infinite alternate',
              'spin-slow': 'spin 3s linear infinite',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' }
              },
              slideUp: {
                '0%': { opacity: '0', transform: 'translateY(30px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' }
              },
              pulseGlow: {
                '0%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.5)' },
                '100%': { boxShadow: '0 0 30px rgba(59, 130, 246, 0.8)' }
              }
            }
          }
        }
      }
    </script>
    <style>
      .glass-effect {
        backdrop-filter: blur(16px);
        background: rgba(17, 24, 39, 0.8);
        border: 1px solid rgba(75, 85, 99, 0.3);
      }
      .loading-bar {
        background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.8), transparent);
        animation: loading-sweep 1.5s infinite;
      }
      @keyframes loading-sweep {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      .movie-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .movie-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      }
      .gradient-bg {
        background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 50%, #ec4899 100%);
      }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 text-white">
    <!-- Animated background particles -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
      <div class="absolute top-3/4 right-1/4 w-64 h-64 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse delay-1000"></div>
      <div class="absolute bottom-1/4 left-1/2 w-64 h-64 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse delay-2000"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8">
      <!-- Header -->
      <header class="text-center mb-12 animate-fade-in">
        <h1 class="text-6xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400">
          üé¨ CineSearch
        </h1>
        <p class="text-xl text-gray-300 max-w-2xl mx-auto">
          Discover amazing movies with our beautiful search interface
        </p>
      </header>

      <!-- Search Section -->
      <div class="max-w-2xl mx-auto mb-12 animate-slide-up">
        <form id="searchForm" class="relative">
          <div class="glass-effect rounded-2xl p-6 shadow-2xl">
            <div class="flex gap-4">
              <div class="flex-1 relative">
                <input
                  id="query"
                  type="text"
                  placeholder="Search for movies..."
                  class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300"
                />
                <div class="absolute inset-x-0 bottom-0 h-0.5 bg-gradient-to-r from-transparent via-blue-500 to-transparent opacity-0 transition-opacity duration-300" id="searchGlow"></div>
              </div>
              <button
                type="submit"
                class="px-8 py-4 gradient-bg rounded-xl font-semibold transform transition-all duration-300 hover:scale-105 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900"
                id="searchBtn"
              >
                <span id="searchText">Search</span>
                <div id="searchSpinner" class="hidden">
                  <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </div>
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Loading Bar -->
      <div id="loadingBar" class="hidden fixed top-0 left-0 right-0 z-50">
        <div class="h-1 bg-gray-800 overflow-hidden">
          <div class="loading-bar h-full w-32"></div>
        </div>
      </div>

      <!-- Results Info -->
      <div id="resultsInfo" class="hidden text-center mb-8 animate-fade-in">
        <div class="glass-effect rounded-xl p-4 max-w-md mx-auto">
          <p id="resultCount" class="text-gray-300"></p>
        </div>
      </div>

      <!-- Results Grid -->
      <div id="results" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>

      <!-- Pagination -->
      <div id="pagination" class="hidden mt-16 flex justify-center items-center gap-4">
        <button id="prevBtn" class="px-6 py-3 glass-effect rounded-xl hover:bg-gray-700/50 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
          ‚Üê Previous
        </button>
        <div id="pageInfo" class="px-6 py-3 glass-effect rounded-xl"></div>
        <button id="nextBtn" class="px-6 py-3 glass-effect rounded-xl hover:bg-gray-700/50 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
          Next ‚Üí
        </button>
      </div>

      <!-- No Results -->
      <div id="noResults" class="hidden text-center py-16 animate-fade-in">
        <div class="text-6xl mb-4">üé≠</div>
        <h3 class="text-2xl font-semibold mb-2 text-gray-300">No movies found</h3>
        <p class="text-gray-400">Try searching with different keywords</p>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="hidden text-center py-16 animate-fade-in">
        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
        <h3 class="text-2xl font-semibold mb-2 text-red-400">Something went wrong</h3>
        <p id="errorText" class="text-gray-400"></p>
      </div>
    </div>

    <!-- Movie Modal -->
    <div id="movieModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
      <div class="glass-effect rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex justify-between items-start mb-6">
            <h2 id="modalTitle" class="text-3xl font-bold"></h2>
            <button id="closeModal" class="text-gray-400 hover:text-white text-2xl">√ó</button>
          </div>
          <div id="modalContent"></div>
        </div>
      </div>
    </div>

    <script>
      // Function to copy magnet link and show toast
      async function copyMagnet(magnet, index) {
        try {
          await navigator.clipboard.writeText(magnet);
          
          // Update button text temporarily
          const copyText = document.getElementById(`copy-text-${index}`);
          const originalText = copyText.textContent;
          copyText.textContent = 'Copied!';
          
          // Create and show toast
          const toast = document.createElement('div');
          toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-y-0 opacity-100 z-50';
          toast.innerHTML = `
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span>Magnet link copied to clipboard!</span>
            </div>
          `;
          document.body.appendChild(toast);
          
          // Reset button text and remove toast after 2 seconds
          setTimeout(() => {
            copyText.textContent = originalText;
            toast.classList.add('translate-y-2', 'opacity-0');
            setTimeout(() => toast.remove(), 300);
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
          // Show error toast
          const toast = document.createElement('div');
          toast.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-y-0 opacity-100 z-50';
          toast.innerHTML = `
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
              <span>Failed to copy magnet link</span>
            </div>
          `;
          document.body.appendChild(toast);
          
          // Remove error toast after 2 seconds
          setTimeout(() => {
            toast.classList.add('translate-y-2', 'opacity-0');
            setTimeout(() => toast.remove(), 300);
          }, 2000);
        }
      }

      class MovieSearch {
        constructor() {
          this.currentPage = 1;
          this.moviesPerPage = 8;
          this.allMovies = [];
          this.currentQuery = '';
          this.init();
        }

        init() {
          this.bindEvents();
          this.addInputEffects();
        }

        bindEvents() {
          document.getElementById('searchForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.search();
          });

          document.getElementById('prevBtn').addEventListener('click', () => {
            this.previousPage();
          });

          document.getElementById('nextBtn').addEventListener('click', () => {
            this.nextPage();
          });

          document.getElementById('closeModal').addEventListener('click', () => {
            this.closeModal();
          });

          document.getElementById('movieModal').addEventListener('click', (e) => {
            if (e.target.id === 'movieModal') {
              this.closeModal();
            }
          });
        }

        addInputEffects() {
          const input = document.getElementById('query');
          const glow = document.getElementById('searchGlow');
          
          input.addEventListener('focus', () => {
            glow.style.opacity = '1';
          });
          
          input.addEventListener('blur', () => {
            glow.style.opacity = '0';
          });
        }

        async search() {
          const query = document.getElementById('query').value.trim();
          if (!query) return;

          this.currentQuery = query;
          this.currentPage = 1;
          this.showLoading();

          try {
            const response = await fetch(`/api/search/yts?query=${encodeURIComponent(query)}`);
            const data = await response.json();
            
            this.hideLoading();
            this.handleResults(data);
          } catch (error) {
            this.hideLoading();
            this.showError('Failed to search movies. Please try again.');
          }
        }

        showLoading() {
          document.getElementById('loadingBar').classList.remove('hidden');
          document.getElementById('searchSpinner').classList.remove('hidden');
          document.getElementById('searchText').classList.add('hidden');
          document.getElementById('searchBtn').disabled = true;
        }

        hideLoading() {
          document.getElementById('loadingBar').classList.add('hidden');
          document.getElementById('searchSpinner').classList.add('hidden');
          document.getElementById('searchText').classList.remove('hidden');
          document.getElementById('searchBtn').disabled = false;
        }

        handleResults(data) {
          this.hideAllSections();

          if (data.status !== 'ok') {
            this.showError(data.error || 'Search failed');
            return;
          }

          if (data.movie_count === 0) {
            this.showNoResults();
            return;
          }

          this.allMovies = data.data;
          this.showResultsInfo(data.movie_count);
          this.renderPage();
          this.updatePagination();
        }

        hideAllSections() {
          document.getElementById('results').innerHTML = '';
          document.getElementById('noResults').classList.add('hidden');
          document.getElementById('errorMessage').classList.add('hidden');
          document.getElementById('resultsInfo').classList.add('hidden');
          document.getElementById('pagination').classList.add('hidden');
        }

        showError(message) {
          document.getElementById('errorText').textContent = message;
          document.getElementById('errorMessage').classList.remove('hidden');
        }

        showNoResults() {
          document.getElementById('noResults').classList.remove('hidden');
        }

        showResultsInfo(count) {
          document.getElementById('resultCount').textContent = 
            `Found ${count} movie${count !== 1 ? 's' : ''} for "${this.currentQuery}"`;
          document.getElementById('resultsInfo').classList.remove('hidden');
        }

        renderPage() {
          const startIndex = (this.currentPage - 1) * this.moviesPerPage;
          const endIndex = startIndex + this.moviesPerPage;
          const movies = this.allMovies.slice(startIndex, endIndex);

          const resultsDiv = document.getElementById('results');
          resultsDiv.innerHTML = '';

          movies.forEach((movie, index) => {
            const card = this.createMovieCard(movie, startIndex + index);
            resultsDiv.appendChild(card);
          });

          // Animate cards
          setTimeout(() => {
            document.querySelectorAll('.movie-card').forEach((card, index) => {
              setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
              }, index * 100);
            });
          }, 50);
        }

        createMovieCard(movie, index) {
          const card = document.createElement('div');
          card.className = 'movie-card glass-effect rounded-xl overflow-hidden transform transition-all duration-500 hover:scale-105 cursor-pointer opacity-0 translate-y-8';
          card.style.animationDelay = `${index * 0.1}s`;

          const imageUrl = movie.cover_image || 'https://via.placeholder.com/300x450/374151/9CA3AF?text=No+Image';
          const year = movie.year || 'Unknown';
          const description = movie.description ? 
            (movie.description.length > 100 ? movie.description.substring(0, 100) + '...' : movie.description) : 
            'No description available';

          card.innerHTML = `
            <div class="aspect-[2/3] relative overflow-hidden">
              <img 
                src="${imageUrl}" 
                alt="${movie.name}" 
                class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
              <div class="absolute bottom-4 left-4 right-4 transform translate-y-4 opacity-0 hover:translate-y-0 hover:opacity-100 transition-all duration-300">
                <div class="flex items-center gap-2 text-sm">
                  <span class="bg-blue-600 px-2 py-1 rounded text-xs font-semibold">${year}</span>
                  ${movie.language ? `<span class="bg-purple-600 px-2 py-1 rounded text-xs font-semibold">${movie.language}</span>` : ''}
                </div>
              </div>
            </div>
            <div class="p-6">
              <h3 class="font-bold text-lg mb-2 line-clamp-2">${movie.name}</h3>
              <p class="text-gray-400 text-sm mb-4 line-clamp-3">${description}</p>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  ${movie.torrents && movie.torrents.length > 0 ? `
                    <div class="flex gap-1">
                      ${movie.torrents.slice(0, 3).map(torrent => `
                        <span class="bg-green-600/20 text-green-400 px-2 py-1 rounded text-xs font-medium">
                          ${torrent.quality}
                        </span>
                      `).join('')}
                    </div>
                  ` : ''}
                </div>
                <button class="text-blue-400 hover:text-blue-300 text-sm font-medium">
                  View Details ‚Üí
                </button>
              </div>
            </div>
          `;

          card.addEventListener('click', () => this.showMovieDetails(movie));
          return card;
        }

        showMovieDetails(movie) {
          const modal = document.getElementById('movieModal');
          const title = document.getElementById('modalTitle');
          const content = document.getElementById('modalContent');

          title.textContent = movie.name;

          const imageUrl = movie.cover_image || 'https://via.placeholder.com/300x450/374151/9CA3AF?text=No+Image';
          const torrents = movie.torrents || [];

          content.innerHTML = `
            <div class="grid md:grid-cols-3 gap-8">
              <div class="md:col-span-1">
                <img 
                  src="${imageUrl}" 
                  alt="${movie.name}" 
                  class="w-full rounded-xl shadow-2xl"
                />
              </div>
              <div class="md:col-span-2">
                <div class="space-y-6">
                  <div>
                    <h4 class="text-xl font-semibold mb-2">Movie Information</h4>
                    <div class="space-y-2">
                      <p><span class="text-gray-400">Year:</span> <span class="text-white">${movie.year || 'Unknown'}</span></p>
                      <p><span class="text-gray-400">Language:</span> <span class="text-white">${movie.language || 'Unknown'}</span></p>
                      ${movie.imdb ? `<p><span class="text-gray-400">IMDB:</span> <a href="https://imdb.com/title/${movie.imdb}" target="_blank" class="text-blue-400 hover:text-blue-300">${movie.imdb}</a></p>` : ''}
                    </div>
                  </div>

                  ${movie.description ? `
                    <div>
                      <h4 class="text-xl font-semibold mb-2">Synopsis</h4>
                      <p class="text-gray-300 leading-relaxed">${movie.description}</p>
                    </div>
                  ` : ''}

                  ${torrents.length > 0 ? `
                    <div>
                      <h4 class="text-xl font-semibold mb-4">Available Downloads</h4>
                      <div class="space-y-3">
                        ${torrents.map((torrent, index) => `
                          <div class="glass-effect rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                              <div class="flex items-center gap-3">
                                <span class="bg-green-600 px-3 py-1 rounded-full text-sm font-semibold">${torrent.quality}</span>
                                <span class="text-gray-400 text-sm">${torrent.type || 'Movie'}</span>
                              </div>
                              <div class="flex items-center gap-2">
                                <span class="text-gray-400 text-sm">${torrent.size || 'Unknown size'}</span>
                                ${torrent.magnet ? `
                                  <button 
                                    onclick="copyMagnet('${torrent.magnet.replace(/'/g, "\\'")}', ${index})" 
                                    class="copy-magnet-btn flex items-center gap-2 px-3 py-1 bg-red-600 hover:bg-red-500 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105"
                                    id="copy-btn-${index}"
                                  >
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                      <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V19C3 20.11 3.89 21 5 21H11V19H5V3H13V9H21ZM20.5 11.5L23 14L20.5 16.5L19 15L20 14L19 13L20.5 11.5ZM15.5 11.5L17 13L16 14L17 15L15.5 16.5L13 14L15.5 11.5Z"/>
                                    </svg>
                                    <span id="copy-text-${index}">Copy Magnet</span>
                                  </button>
                                ` : ''}
                              </div>
                            </div>
                            <div class="flex items-center gap-4 text-sm">
                              <span class="text-green-400">üå± ${torrent.seeds} seeds</span>
                              <span class="text-blue-400">üë• ${torrent.peers} peers</span>
                              ${torrent.upload_date ? `<span class="text-gray-400">üìÖ ${new Date(torrent.upload_date).toLocaleDateString()}</span>` : ''}
                            </div>
                          </div>
                        `).join('')}
                      </div>
                    </div>
                  ` : ''}
                </div>
              </div>
            </div>
          `;

          modal.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
        }

        closeModal() {
          document.getElementById('movieModal').classList.add('hidden');
          document.body.style.overflow = 'auto';
        }

        updatePagination() {
          const totalPages = Math.ceil(this.allMovies.length / this.moviesPerPage);
          
          if (totalPages <= 1) {
            document.getElementById('pagination').classList.add('hidden');
            return;
          }

          document.getElementById('pagination').classList.remove('hidden');
          document.getElementById('pageInfo').textContent = `Page ${this.currentPage} of ${totalPages}`;
          
          document.getElementById('prevBtn').disabled = this.currentPage === 1;
          document.getElementById('nextBtn').disabled = this.currentPage === totalPages;
        }

        previousPage() {
          if (this.currentPage > 1) {
            this.currentPage--;
            this.renderPage();
            this.updatePagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        }

        nextPage() {
          const totalPages = Math.ceil(this.allMovies.length / this.moviesPerPage);
          if (this.currentPage < totalPages) {
            this.currentPage++;
            this.renderPage();
            this.updatePagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        }
      }

      // Initialize the app
      new MovieSearch();
    </script>
  </body>
</html>